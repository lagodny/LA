
# Управление цветами в проектах

## Принципы

- ограниченное количество цветов, каждый цвет имеет свою роль (например: фон, контейнер, поверхность, цвет на поверхности и т.д.)
- все должно быть различимо на монохромном экране (и для дальтонников)
- легкое переключение между темами (светлая, темная, контрастная и т.д.)

## Подготовка

Используем наработки https://m3.material.io/styles/color/roles
- Color roles are mapped to Material Components
You'll use these color roles whether you're using the static baseline scheme or dynamic color. If your product contains custom components, they'll need to be properly mapped to this set of color roles.
- Color roles ensure accessibility
The color system is built on accessible color pairings. These color pairs provide an accessible minimum 3:1 contrast.
- Color roles are tokenized
Roles are implemented in design and code through tokens. A design token represents a small, reusable design decision that’s part of a design system's visual style. 

Подобрать нужную схему можно с помощью **Figma** и плагина **Material Shema Builder** https://m3.material.io/styles/color/resources
После подбора получим JSON с необходимыми цветами для основных ролей.

## Delphi - реализация

В **Delphi** для каждого свойства типа **TAlhpaColor** есть набор именованных цветов и было бы хорошо расширить его, но это невозможно выполнить простым добавлением новых элементов.  
Задача решается добавлением **своего редактора свойств** (TLAAlphaColorProperty), который будет выполнять обработку дополнительных **Идентификаторов** цветов. Также необходимо подменить функции преобразования **Идентификатора в цвет** и **Цвета в идентификатор**.  
Таблицу преобразования Идентификатора в Цвет делаем доступной для изменения, это позволит нам проставлять Идентификаторам правильные цвета, соответствующие той или иной теме (светлой, темной и пр.). Реализуем функции инициализации цветов из JSON.  
Важно, новые цвета и идентификаторы должны быть **уникальными**.

### Применение новой темы в открытых формах

Формы и компоненты оперируют значениями цветов а не Идентификаторами. Идентификаторы можно найти только в ресурсах формы или фрейма. Поэтому чтобы в свойство типа Цвет компонента установилось новое значение из новой темы необходимо вычитать из ресурсов Идентификатор и для этого Идентификатора будет найдено новое значение Цвета.  
Обычный алгоритм создания компонента из ресурсов предполагает **именно создание**. Это нам не подходит. Поэтому создаем свой объект, который будет использовать стандартный TReader но только для операций чтения данных, сам же алгоритм обработки этих данных будет предполагать поиск уже существующих компонентов и обновление их свойств, если проверка прошла успешно. Функцию такой проверки можно передать в объект. Если функция не передана, то будут обрабатываться свойства, в названии которых есть текст **color**.

### Использование в стилях

В стилях желательно использовать только вектор или же TINT режим.